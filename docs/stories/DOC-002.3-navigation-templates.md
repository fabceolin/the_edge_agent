# DOC-002.3: Navigation & Templates Extraction

## Status

| Field | Value |
|-------|-------|
| **ID** | DOC-002.3 |
| **Epic** | [DOC-002](./DOC-002-yaml-reference-modularization.md) |
| **Title** | Navigation & Templates Extraction |
| **Type** | Documentation |
| **Priority** | Medium |
| **Status** | Done |
| **Estimated Effort** | 45 minutes |
| **Depends On** | DOC-002.1 |

---

## Story

**As a** YAML agent developer,
**I want** dedicated documents for navigation flow and template syntax,
**so that** I can quickly reference routing logic and Jinja2 features.

---

## Acceptance Criteria

1. **Given** the Navigation and Flow Control section
   **When** I extract it to `yaml-reference/navigation.md`
   **Then** all content is preserved including:
   - Implicit Chaining
   - The `goto` Property
   - Conditional `goto`
   - Navigation Precedence
   - Edge Specification (deprecated)

2. **Given** the Template Syntax section
   **When** I extract it to `yaml-reference/templates.md`
   **Then** all content is preserved including:
   - Basic Substitution
   - Jinja2 Filters
   - Jinja2 Constructs
   - Object Passthrough
   - Undefined Variable Handling
   - Security Note

3. **Given** the main YAML_REFERENCE.md
   **When** extraction is complete
   **Then** summaries with links replace full content

---

## Tasks / Subtasks

- [x] Extract Navigation and Flow Control (AC: 1)
  - [x] Copy section from YAML_REFERENCE.md
  - [x] Include all subsections (implicit chaining, goto, loops, etc.)
  - [x] Include Edge Specification (deprecated) section
  - [x] Preserve all examples

- [x] Extract Template Syntax (AC: 2)
  - [x] Copy section from YAML_REFERENCE.md
  - [x] Include all Jinja2 filters and constructs
  - [x] Include GitHub Actions equivalents table
  - [x] Preserve all examples

- [x] Add navigation and cross-references
  - [x] Add parent document links
  - [x] Cross-link between navigation.md and templates.md where relevant
  - [x] Link to nodes.md for execution context

- [x] Update main YAML_REFERENCE.md (AC: 3)
  - [x] Replace Navigation section with summary + link
  - [x] Replace Template Syntax section with summary + link
  - [x] Keep anchors for backwards compatibility

---

## Dev Notes

### navigation.md Content Sections

1. Overview
2. Implicit Chaining (Default)
3. The `goto` Property
   - Unconditional goto
   - Special goto Targets
4. Conditional `goto`
   - Context Variables in Conditions
5. Loops with `goto`
6. Navigation Precedence
7. Migration from Edges
8. Edge Specification (Deprecated)
   - Basic Structure
   - Edge Types
   - Parallel Edges

### templates.md Content Sections

1. Overview (Jinja2 choice rationale)
2. Basic Substitution
   - State, Variables, Secrets
   - Checkpoint context
3. Jinja2 Filters
   - Built-in filters
   - Custom filters (tojson, fromjson)
4. Jinja2 Constructs
   - Conditionals
   - Loops
5. GitHub Actions to Jinja2 Equivalents
6. Object Passthrough
7. Undefined Variable Handling
8. Security Note
9. Template in Different Contexts
10. Nested Access

### Summary Templates

**Navigation summary:**
```markdown
## Navigation and Flow Control

> **Full documentation:** [yaml-reference/navigation.md](./yaml-reference/navigation.md)

TEA supports implicit chaining (nodes execute in order) and explicit `goto` properties for branching:

- **Implicit flow:** node1 → node2 → node3 → __end__
- **Unconditional goto:** `goto: target_node`
- **Conditional goto:** `goto:` list with `if`/`to` rules
- **Loops:** Conditional goto back to earlier nodes

For complete navigation reference including deprecated edges, see [Navigation & Flow Control](./yaml-reference/navigation.md).
```

**Template summary:**
```markdown
## Template Syntax

> **Full documentation:** [yaml-reference/templates.md](./yaml-reference/templates.md)

Templates use **Jinja2** syntax for variable interpolation:

| Syntax | Description |
|--------|-------------|
| `{{ state.key }}` | Access state value |
| `{{ variables.key }}` | Access global variable |
| `{{ secrets.key }}` | Access secret |
| `{{ value \| filter }}` | Apply filter |

Common filters: `tojson`, `fromjson`, `upper`, `lower`, `default`, `length`, `join`

For complete template reference including conditionals and loops, see [Template Syntax](./yaml-reference/templates.md).
```

---

## Testing

- Verify all Jinja2 examples render correctly
- Verify all goto examples are accurate
- Verify cross-links between navigation and templates work
- Verify deprecated edges section preserved with warnings

---

## Definition of Done

- [x] `yaml-reference/navigation.md` contains complete navigation docs
- [x] `yaml-reference/templates.md` contains complete template docs
- [x] All examples preserved and formatted
- [x] Cross-references between documents work
- [x] Main YAML_REFERENCE.md has summaries with links
- [x] Deprecated edges section clearly marked

---

## Dev Agent Record

| Field | Value |
|-------|-------|
| Agent | Claude Opus 4.5 |
| Date | 2025-12-27 |
| Duration | Part of batch (DOC-002.2-002.5) |
| Files Created | `navigation.md` (328 lines), `templates.md` (204 lines) |
| Notes | Extracted navigation flow and Jinja2 template syntax |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-27 | 1.0 | Story created | Sarah (PO Agent) |
| 2025-12-27 | 1.1 | Story completed | Claude Opus 4.5 (Dev Agent) |
