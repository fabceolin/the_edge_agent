# DOC-002.4: Advanced Runtimes Extraction

## Status

| Field | Value |
|-------|-------|
| **ID** | DOC-002.4 |
| **Epic** | [DOC-002](./DOC-002-yaml-reference-modularization.md) |
| **Title** | Advanced Runtimes Extraction (Lua & Prolog) |
| **Type** | Documentation |
| **Priority** | Medium |
| **Status** | Done |
| **Estimated Effort** | 30 minutes |
| **Depends On** | DOC-002.1, DOC-002.2 |

---

## Story

**As a** developer using neurosymbolic features,
**I want** a dedicated document for Lua and Prolog runtimes,
**so that** I can find all cross-runtime compatibility details in one place.

---

## Acceptance Criteria

1. **Given** the Lua code sections in nodes.md (Method 2b)
   **When** I extract detailed Lua docs to `yaml-reference/advanced-runtimes.md`
   **Then** all content is preserved including:
   - Enabling Lua
   - Explicit marker and auto-detection
   - Lua Sandbox
   - Timeout Protection
   - Cross-Runtime Compatibility (LuaJIT vs Lua 5.4)

2. **Given** the Prolog code sections (Method 2c)
   **When** I extract to the same file
   **Then** all content is preserved including:
   - Enabling Prolog (Python and Rust)
   - Module Pre-Loading
   - State Interface (state/2, return/2)
   - CLP(FD) Constraint Solving
   - Prolog Sandbox
   - Runtime Comparison Table
   - Neurosymbolic AI Use Cases

3. **Given** the nodes.md file
   **When** extraction is complete
   **Then** nodes.md has brief summaries linking to advanced-runtimes.md

---

## Tasks / Subtasks

- [x] Extract Lua documentation (AC: 1)
  - [x] Create Lua section with all subsections
  - [x] Include cross-runtime compatibility table
  - [x] Include portable syntax examples
  - [x] Include "syntax to avoid" section

- [x] Extract Prolog documentation (AC: 2)
  - [x] Create Prolog section with all subsections
  - [x] Include Runtime Comparison Table
  - [x] Include Module Pre-Loading details
  - [x] Include CLP(FD) examples
  - [x] Include Neurosymbolic use cases

- [x] Update nodes.md (AC: 3)
  - [x] Keep brief Lua summary in Method 2b
  - [x] Keep brief Prolog summary in Method 2c
  - [x] Add prominent links to advanced-runtimes.md

- [x] Add navigation and cross-references
  - [x] Add parent document link header
  - [x] Add "See Also" section
  - [x] Link to relevant example files

---

## Dev Notes

### Document Structure for advanced-runtimes.md

```markdown
# Advanced Runtimes (Lua & Prolog)

> **Parent document:** [YAML Reference](../YAML_REFERENCE.md)
> **Related:** [Node Specification](./nodes.md)

## Overview

TEA supports alternative runtimes for specific use cases...

---

## Lua Runtime

### Enabling Lua
### Syntax Markers
### Auto-Detection
### Lua Sandbox
### Timeout Protection
### Cross-Runtime Compatibility
#### LuaJIT 2.1 (Python) vs Lua 5.4 (Rust)
#### Portable Syntax Examples
#### Syntax to Avoid

---

## Prolog Runtime

### Enabling Prolog
#### Python Runtime
#### Rust Runtime
### Module Pre-Loading
### State Interface
#### state/2 Predicate
#### return/2 Predicate
### CLP(FD) Constraint Solving
### Prolog Sandbox
### Timeout Protection
### Runtime Comparison Table
### Neurosymbolic AI Use Cases
### Example: LLM + Prolog Validation

---

## See Also

- [Node Specification](./nodes.md) - All execution methods
- [examples/prolog/neurosymbolic/](../../examples/prolog/neurosymbolic/) - Example agents
```

### Summary for nodes.md Method 2b (Lua)

```markdown
#### Method 2b: Lua Code (`run:` with `-- lua` marker)

Execute Lua code for cross-runtime compatibility with the Rust implementation.

```yaml
- name: process_lua
  run: |
    -- lua
    local result = state.value * 2
    return { doubled = result }
```

> **Complete Lua documentation:** [Advanced Runtimes - Lua](./advanced-runtimes.md#lua-runtime)
> Includes sandbox details, cross-runtime compatibility, and portable syntax guide.
```

### Summary for nodes.md Method 2c (Prolog)

```markdown
#### Method 2c: Prolog Code (`language: prolog`)

Execute Prolog code for neurosymbolic AI workflows.

```yaml
- name: validate
  language: prolog
  run: |
    state(value, V),
    V2 is V * 2,
    return(result, V2).
```

> **Complete Prolog documentation:** [Advanced Runtimes - Prolog](./advanced-runtimes.md#prolog-runtime)
> Includes CLP(FD), module pre-loading, and runtime comparison.
```

---

## Testing

- Verify all Lua examples work in both Python and Rust
- Verify Prolog examples are accurate
- Verify cross-runtime compatibility table is complete
- Verify links to example files work

---

## Definition of Done

- [x] `yaml-reference/advanced-runtimes.md` contains complete Lua docs
- [x] `yaml-reference/advanced-runtimes.md` contains complete Prolog docs
- [x] All examples preserved and formatted
- [x] Cross-runtime compatibility clearly documented
- [x] nodes.md has brief summaries with links
- [x] Links to example agents work

---

## Dev Agent Record

| Field | Value |
|-------|-------|
| Agent | Claude Opus 4.5 |
| Date | 2025-12-27 |
| Duration | Part of batch (DOC-002.2-002.5) |
| Files Created | `advanced-runtimes.md` (401 lines) |
| Notes | Extracted Lua and Prolog runtime docs with cross-platform compatibility tables |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-27 | 1.0 | Story created | Sarah (PO Agent) |
| 2025-12-27 | 1.1 | Story completed | Claude Opus 4.5 (Dev Agent) |
