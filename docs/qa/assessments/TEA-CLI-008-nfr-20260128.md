# NFR Assessment: TEA-CLI-008

**Date:** 2026-01-28
**Reviewer:** Quinn (Test Architect)
**Mode:** YOLO (Non-interactive, Core Four NFRs)
**Story:** TEA-CLI-008.fail-on-workflow-state.md

---

## Summary

| NFR | Status | Score Impact | Key Finding |
|-----|--------|--------------|-------------|
| Security | **CONCERNS** | -10 | Predictable temp files; shell escaping review needed |
| Performance | **PASS** | 0 | Minimal overhead, O(1) operations |
| Reliability | **CONCERNS** | -10 | Window name collision; no crash cleanup |
| Maintainability | **CONCERNS** | -10 | Code duplication across 3 branches |

**Quality Score: 70/100**

---

## Critical Issues

1. **Temp file predictability** (Security)
   - Risk: Symlink attacks on `/tmp/tea_dot_exit_{window_name}`
   - Fix: Use `tempfile.mkstemp()` with unique suffix

2. **Code duplication** (Maintainability)
   - Risk: `--fail-on-state` logic needed in 3 branches will diverge
   - Fix: Extract `check_fail_on_state()` helper function

3. **Window name collision** (Reliability)
   - Risk: Parallel nodes with similar labels produce same window name
   - Fix: Include run ID or node index in window name

---

## Quick Wins

- Add input validation for `--fail-on-state` format: ~30 min
- Extract helper function for fail-on-state check: ~1 hour
- Add `atexit` handler for temp file cleanup: ~30 min
- Include timestamp in temp filenames: ~15 min

---

## Gate Integration

```yaml
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: CONCERNS
    notes: 'Predictable temp file paths; needs input validation for --fail-on-state'
  performance:
    status: PASS
    notes: 'O(1) operations, negligible overhead'
  reliability:
    status: CONCERNS
    notes: 'Window name collision risk; no crash cleanup for temp files'
  maintainability:
    status: CONCERNS
    notes: 'Code duplication across 3 output branches; breaking default change'
```

Gate NFR block ready -> paste into docs/qa/gates/TEA-CLI-008-fail-on-workflow-state.yml under nfr_validation
